{% extends "base.html" %}

{% block title %}{{ article.title }} - {{ SITENAME }}{% endblock %}

{% block description %}{{ article.meta_description or article.summary|striptags|truncate(160) }}{% endblock %}

{% block og_type %}article{% endblock %}
{% block og_title %}{{ article.og_title or article.title }}{% endblock %}
{% block og_description %}{{ article.og_description or article.meta_description or article.summary|striptags|truncate(160) }}{% endblock %}
{% block og_url %}/{{ article.url }}{% endblock %}
{% block og_image %}{{ article.og_image or (SITEURL + "/theme/images/og-image.jpg") }}{% endblock %}

{% block twitter_title %}{{ article.twitter_title or article.title }}{% endblock %}
{% block twitter_description %}{{ article.twitter_description or article.meta_description or article.summary|striptags|truncate(160) }}{% endblock %}
{% block twitter_image %}{{ article.twitter_image or (SITEURL + "/theme/images/og-image.jpg") }}{% endblock %}

{% block structured_data %}
{% if article.structured_data %}
<script type="application/ld+json">
{{ article.structured_data | tojson }}
</script>
{% endif %}
{% endblock %}

{% block extra_head %}
<meta name="keywords" content="{% if article.tags %}{% for tag in article.tags %}{{ tag }}{% if not loop.last %}, {% endif %}{% endfor %}{% endif %}">
<meta name="article:published_time" content="{{ article.date.isoformat() }}">
{% if article.modified %}
<meta name="article:modified_time" content="{{ article.modified.isoformat() }}">
{% endif %}
<meta name="article:author" content="{{ article.author }}">
<meta name="article:section" content="{{ article.category }}">
{% for tag in article.tags %}
<meta name="article:tag" content="{{ tag }}">
{% endfor %}
{% endblock %}

{% block body_class %}article-page{% endblock %}

{% block content %}
<div class="container container-narrow">
    <!-- Breadcrumb Navigation -->
    <nav class="breadcrumb" aria-label="Breadcrumb">
        <div class="breadcrumb-item">
            <a href="{{ SITEURL }}/" class="breadcrumb-link">Home</a>
        </div>
        <span class="breadcrumb-separator">
            <i class="fas fa-chevron-right" aria-hidden="true"></i>
        </span>
        <div class="breadcrumb-item">
            <a href="{{ SITEURL }}/archives/" class="breadcrumb-link">Blog</a>
        </div>
        <span class="breadcrumb-separator">
            <i class="fas fa-chevron-right" aria-hidden="true"></i>
        </span>
        <div class="breadcrumb-item">
            <span class="breadcrumb-current">{{ article.title }}</span>
        </div>
    </nav>

    <article class="article">
        <!-- Article Header -->
        <header class="article-header">
            <h1 class="article-title">{{ article.title }}</h1>
            
            <!-- Article Meta -->
            <div class="article-meta">
                <div class="meta-item">
                    <i class="fas fa-calendar meta-icon" aria-hidden="true"></i>
                    <time datetime="{{ article.date.isoformat() }}">{{ article.locale_date }}</time>
                </div>
                
                {% if article.modified %}
                <div class="meta-item">
                    <i class="fas fa-edit meta-icon" aria-hidden="true"></i>
                    <time datetime="{{ article.modified.isoformat() }}">Updated {{ article.modified.strftime('%B %d, %Y') }}</time>
                </div>
                {% endif %}
                
                {% if article.category %}
                <div class="meta-item">
                    <i class="fas fa-folder meta-icon" aria-hidden="true"></i>
                    <a href="{{ SITEURL }}/{{ article.category.url }}" class="meta-link">{{ article.category }}</a>
                </div>
                {% endif %}
                
                {% if article.author %}
                <div class="meta-item">
                    <i class="fas fa-user meta-icon" aria-hidden="true"></i>
                    <span>{{ article.author }}</span>
                </div>
                {% endif %}
                
                <div class="meta-item">
                    <i class="fas fa-clock meta-icon" aria-hidden="true"></i>
                    <span>{{ article.content | wordcount // 200 or 1 }} min read</span>
                </div>
            </div>

            <!-- Featured Image -->
            {% if article.featured_image %}
            <figure class="article-featured-image">
                <img src="{{ SITEURL }}/{{ article.featured_image }}" alt="{{ article.title }}" loading="lazy">
                {% if article.featured_image_caption %}
                <figcaption>{{ article.featured_image_caption }}</figcaption>
                {% endif %}
            </figure>
            {% endif %}
        </header>

        <!-- Article Content -->
        <div class="article-content">
            {{ article.content }}
        </div>

        <!-- Article Tags and Share -->
        <footer class="article-footer">
            {% if article.tags %}
            <div class="article-tags">
                <h3 class="tags-title">Tags</h3>
                <ul class="tag-list">
                    {% for tag in article.tags %}
                    <li class="tag-item">
                        <a href="{{ SITEURL }}/{{ tag.url }}" class="tag-link">{{ tag }}</a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            <!-- Share Buttons -->
            <div class="share-buttons">
                <h3 class="share-title">Share this article</h3>
                <div class="share-links">
                    <a href="https://twitter.com/intent/tweet?url={{ SITEURL }}/{{ article.url }}&text={{ article.title | urlencode }}" class="share-link twitter" target="_blank" rel="noopener noreferrer" aria-label="Share on Twitter">
                        <i class="fab fa-twitter" aria-hidden="true"></i>
                    </a>
                    <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ SITEURL }}/{{ article.url }}" class="share-link linkedin" target="_blank" rel="noopener noreferrer" aria-label="Share on LinkedIn">
                        <i class="fab fa-linkedin" aria-hidden="true"></i>
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u={{ SITEURL }}/{{ article.url }}" class="share-link facebook" target="_blank" rel="noopener noreferrer" aria-label="Share on Facebook">
                        <i class="fab fa-facebook" aria-hidden="true"></i>
                    </a>
                    <a href="mailto:?subject={{ article.title | urlencode }}&body=Check out this article: {{ SITEURL }}/{{ article.url }}" class="share-link email" aria-label="Share via email">
                        <i class="fas fa-envelope" aria-hidden="true"></i>
                    </a>
                </div>
            </div>
        </footer>
    </article>

    <!-- Article Navigation -->
    {% if article.prev_article or article.next_article %}
    <nav class="article-navigation" aria-label="Article navigation">
        {% if article.prev_article %}
        <div class="nav-item nav-prev">
            <div class="nav-label">Previous Post</div>
            <a href="{{ SITEURL }}/{{ article.prev_article.url }}" class="nav-link">
                <i class="fas fa-chevron-left" aria-hidden="true"></i>
                {{ article.prev_article.title }}
            </a>
        </div>
        {% endif %}
        
        {% if article.next_article %}
        <div class="nav-item nav-next">
            <div class="nav-label">Next Post</div>
            <a href="{{ SITEURL }}/{{ article.next_article.url }}" class="nav-link">
                {{ article.next_article.title }}
                <i class="fas fa-chevron-right" aria-hidden="true"></i>
            </a>
        </div>
        {% endif %}
    </nav>
    {% endif %}

    <!-- Related Articles -->
    {% if article.related_posts %}
    <section class="related-articles">
        <h2 class="section-title">Related Articles</h2>
        <div class="related-grid">
            {% for related in article.related_posts[:3] %}
            <article class="related-card">
                <h3 class="related-title">
                    <a href="{{ SITEURL }}/{{ related.url }}">{{ related.title }}</a>
                </h3>
                <div class="related-meta">
                    <time datetime="{{ related.date.isoformat() }}">{{ related.locale_date }}</time>
                </div>
                {% if related.summary %}
                <p class="related-summary">{{ related.summary|striptags|truncate(100) }}</p>
                {% endif %}
            </article>
            {% endfor %}
        </div>
    </section>
    {% endif %}
</div>

<style>
/* Article-specific styles */
.article-header {
    margin-bottom: var(--space-8);
    text-align: center;
}

.article-title {
    font-size: var(--text-4xl);
    margin-bottom: var(--space-6);
    line-height: var(--leading-tight);
}

.article-featured-image {
    margin: var(--space-8) 0;
}

.article-featured-image img {
    width: 100%;
    height: 400px;
    object-fit: cover;
    border-radius: var(--radius-xl);
}

.article-content {
    font-size: var(--text-lg);
    line-height: var(--leading-relaxed);
    margin-bottom: var(--space-8);
}

.article-content h2 {
    margin-top: var(--space-12);
    margin-bottom: var(--space-6);
    padding-top: var(--space-4);
    border-top: 1px solid var(--border-primary);
}

.article-content h3 {
    margin-top: var(--space-8);
    margin-bottom: var(--space-4);
}

.article-content h4,
.article-content h5,
.article-content h6 {
    margin-top: var(--space-6);
    margin-bottom: var(--space-3);
}

.article-content p {
    margin-bottom: var(--space-6);
}

.article-content ul,
.article-content ol {
    margin-bottom: var(--space-6);
}

.article-content li {
    margin-bottom: var(--space-3);
}

.article-content blockquote {
    background-color: var(--bg-secondary);
    border-radius: var(--radius-lg);
    padding: var(--space-6);
    margin: var(--space-8) 0;
}

.article-footer {
    padding-top: var(--space-6);
    border-top: 1px solid var(--border-primary);
}

.article-tags {
    text-align: center;
}

.tags-title {
    font-size: var(--text-lg);
    margin-bottom: var(--space-4);
    color: var(--text-secondary);
}

.article-navigation {
    display: grid;
    grid-template-columns: 1fr 1fr;
  gap: var(--space-4);
    margin: var(--space-12) 0;
    padding: var(--space-6);
    background-color: var(--bg-secondary);
    border-radius: var(--radius-xl);
}

.nav-item {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
}

.nav-prev {
    text-align: left;
}

.nav-next {
    text-align: right;
    grid-column: 2;
}

.nav-label {
    font-size: var(--text-sm);
    color: var(--text-muted);
    font-weight: var(--font-weight-medium);
    text-transform: uppercase;
    letter-spacing: 0.025em;
}

.nav-link {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    color: var(--text-primary);
    text-decoration: none;
    font-weight: var(--font-weight-medium);
    transition: color var(--transition-fast);
}

.nav-link:hover {
    color: var(--color-primary);
    text-decoration: none;
}

.nav-next .nav-link {
    justify-content: flex-end;
}

.related-articles {
    margin-top: var(--space-12);
}

.related-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--space-6);
    margin-top: var(--space-6);
}

.related-card {
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-xl);
    padding: var(--space-6);
    transition: all var(--transition-normal);
}

.related-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px var(--shadow-lg);
    border-color: var(--border-secondary);
}

.related-title {
    font-size: var(--text-lg);
    margin-bottom: var(--space-3);
}

.related-title a {
    color: var(--text-primary);
    text-decoration: none;
}

.related-title a:hover {
    color: var(--color-primary);
}

.related-meta {
    font-size: var(--text-sm);
    color: var(--text-muted);
    margin-bottom: var(--space-3);
}

.related-summary {
    color: var(--text-secondary);
    font-size: var(--text-base);
    line-height: var(--leading-relaxed);
}

/* Mobile responsiveness */
@media (max-width: 768px) {
    .article-title {
        font-size: var(--text-3xl);
    }
    
    .article-content {
        font-size: var(--text-base);
    }
    
    .article-featured-image img {
        height: 250px;
    }
    
    .article-navigation {
        grid-template-columns: 1fr;
        gap: var(--space-6);
    }
    
    .nav-next {
        grid-column: 1;
        text-align: left;
    }
    
    .nav-next .nav-link {
        justify-content: flex-start;
    }
    
    .related-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}